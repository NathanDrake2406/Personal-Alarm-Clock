<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alarm Clock</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600&family=Outfit:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0b;
            --bg-secondary: #141417;
            --bg-elevated: #1c1c21;
            --text-primary: #e8e8ec;
            --text-secondary: #8a8a9a;
            --accent: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.4);
            --danger: #ef4444;
            --danger-glow: rgba(239, 68, 68, 0.4);
            --success: #22c55e;
            --border: #2a2a32;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background-image: 
                radial-gradient(ellipse at 50% 0%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.05) 0%, transparent 40%);
        }

        .container {
            width: 100%;
            max-width: 420px;
        }

        /* Current Time Display */
        .current-time {
            text-align: center;
            margin-bottom: 3rem;
        }

        .time-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 5rem;
            font-weight: 300;
            letter-spacing: -0.02em;
            line-height: 1;
            background: linear-gradient(180deg, var(--text-primary) 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .date-display {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-weight: 300;
        }

        /* Alarm Card */
        .alarm-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.75rem;
            margin-bottom: 1.5rem;
        }

        .alarm-card.ringing {
            animation: ring-pulse 0.5s ease-in-out infinite alternate;
            border-color: var(--danger);
            box-shadow: 0 0 40px var(--danger-glow);
        }

        @keyframes ring-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.01); }
        }

        .section-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        /* Time Input */
        .time-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .time-input {
            flex: 1;
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.5rem;
            font-weight: 400;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            text-align: center;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .time-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        /* Sound Selection */
        .sound-section {
            margin-bottom: 1.5rem;
        }

        .sound-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sound-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sound-option:hover {
            border-color: var(--text-secondary);
        }

        .sound-option.selected {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.08);
        }

        .sound-option input[type="radio"] {
            display: none;
        }

        .radio-circle {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .sound-option.selected .radio-circle {
            border-color: var(--accent);
        }

        .radio-circle::after {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            transform: scale(0);
            transition: transform 0.2s;
        }

        .sound-option.selected .radio-circle::after {
            transform: scale(1);
        }

        .sound-info {
            flex: 1;
            min-width: 0;
        }

        .sound-name {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .sound-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.125rem;
        }

        .preview-btn {
            padding: 0.4rem 0.6rem;
            font-size: 0.7rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
            flex-shrink: 0;
        }

        .preview-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Custom file section */
        .custom-file-wrapper {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }

        .file-input-wrapper {
            position: relative;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }

        .file-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            background: var(--bg-elevated);
            border: 1px dashed var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-label:hover {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.05);
        }

        .file-label.selected {
            border-style: solid;
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.08);
        }

        .file-icon {
            width: 20px;
            height: 20px;
            opacity: 0.6;
            flex-shrink: 0;
        }

        .file-text {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-label.selected .file-text {
            color: var(--text-primary);
        }

        /* Buttons */
        .button-row {
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            flex: 1;
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            font-weight: 500;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            box-shadow: 0 4px 20px var(--accent-glow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            box-shadow: 0 4px 20px var(--danger-glow);
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        /* Status */
        .status {
            text-align: center;
            padding: 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .status.active {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .status.ringing {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
            animation: status-pulse 1s ease-in-out infinite;
        }

        @keyframes status-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .status.active .status-dot {
            animation: dot-blink 2s ease-in-out infinite;
        }

        @keyframes dot-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Footer */
        .footer {
            margin-top: 2rem;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
            opacity: 0.6;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .time-display {
                font-size: 3.5rem;
            }
            .time-input {
                font-size: 2rem;
            }
            .alarm-card {
                padding: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="current-time">
            <div class="time-display" id="currentTime">00:00</div>
            <div class="date-display" id="currentDate">Loading...</div>
        </div>

        <div class="alarm-card" id="alarmCard">
            <div class="section-label">Set Alarm</div>
            <div class="time-input-wrapper">
                <input type="time" class="time-input" id="alarmTime" value="07:00">
            </div>

            <div class="sound-section">
                <div class="section-label">Alarm Sound</div>
                <div class="sound-options" id="soundOptions">
                    <label class="sound-option selected" data-sound="classic">
                        <input type="radio" name="sound" value="classic" checked>
                        <span class="radio-circle"></span>
                        <div class="sound-info">
                            <div class="sound-name">Classic Beep</div>
                            <div class="sound-desc">Traditional alarm tone</div>
                        </div>
                        <button class="preview-btn" data-preview="classic">Preview</button>
                    </label>
                    
                    <label class="sound-option" data-sound="gentle">
                        <input type="radio" name="sound" value="gentle">
                        <span class="radio-circle"></span>
                        <div class="sound-info">
                            <div class="sound-name">Gentle Rise</div>
                            <div class="sound-desc">Soft ascending tones</div>
                        </div>
                        <button class="preview-btn" data-preview="gentle">Preview</button>
                    </label>
                    
                    <label class="sound-option" data-sound="urgent">
                        <input type="radio" name="sound" value="urgent">
                        <span class="radio-circle"></span>
                        <div class="sound-info">
                            <div class="sound-name">Urgent</div>
                            <div class="sound-desc">For heavy sleepers</div>
                        </div>
                        <button class="preview-btn" data-preview="urgent">Preview</button>
                    </label>
                    
                    <label class="sound-option" data-sound="chime">
                        <input type="radio" name="sound" value="chime">
                        <span class="radio-circle"></span>
                        <div class="sound-info">
                            <div class="sound-name">Chime</div>
                            <div class="sound-desc">Pleasant bell tones</div>
                        </div>
                        <button class="preview-btn" data-preview="chime">Preview</button>
                    </label>
                    
                    <label class="sound-option" data-sound="pulse">
                        <input type="radio" name="sound" value="pulse">
                        <span class="radio-circle"></span>
                        <div class="sound-info">
                            <div class="sound-name">Pulse</div>
                            <div class="sound-desc">Rhythmic electronic pulse</div>
                        </div>
                        <button class="preview-btn" data-preview="pulse">Preview</button>
                    </label>
                </div>

                <div class="custom-file-wrapper">
                    <div class="file-input-wrapper">
                        <input type="file" class="file-input" id="soundFile" accept="audio/*">
                        <label class="file-label" id="fileLabel" data-sound="custom">
                            <svg class="file-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 18V5l12-2v13"></path>
                                <circle cx="6" cy="18" r="3"></circle>
                                <circle cx="18" cy="16" r="3"></circle>
                            </svg>
                            <span class="file-text" id="fileName">Or upload your own audio...</span>
                            <button class="preview-btn" id="customPreviewBtn" style="display: none;">Preview</button>
                        </label>
                    </div>
                </div>
            </div>

            <div class="button-row" id="buttonRow">
                <button class="btn btn-primary" id="setAlarmBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="13" r="8"></circle>
                        <path d="M12 9v4l2 2"></path>
                        <path d="M5 3L2 6"></path>
                        <path d="M22 6l-3-3"></path>
                    </svg>
                    Set Alarm
                </button>
            </div>

            <div class="status active" id="status" style="display: none; margin-top: 1rem;">
                <span class="status-dot"></span>
                <span id="statusText">Alarm set for 07:00</span>
            </div>
        </div>

        <div class="footer">
            Keep this tab open Â· Sound will play when alarm triggers
        </div>
    </div>

    <audio id="alarmAudio" loop></audio>

    <script>
        // Audio Context for generated sounds
        let audioContext = null;
        let currentOscillators = [];
        let currentGainNodes = [];

        function getAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        // Sound generators
        const soundGenerators = {
            classic: (ctx, duration = 3) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.frequency.value = 880;
                osc.type = 'square';
                gain.gain.value = 0.3;
                
                // Beep pattern
                const now = ctx.currentTime;
                for (let i = 0; i < duration * 2; i++) {
                    gain.gain.setValueAtTime(0.3, now + i * 0.5);
                    gain.gain.setValueAtTime(0, now + i * 0.5 + 0.3);
                }
                
                osc.start(now);
                osc.stop(now + duration);
                return { oscillators: [osc], gains: [gain] };
            },
            
            gentle: (ctx, duration = 3) => {
                const oscillators = [];
                const gains = [];
                const now = ctx.currentTime;
                const notes = [262, 330, 392, 523]; // C4, E4, G4, C5
                
                notes.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    
                    osc.frequency.value = freq;
                    osc.type = 'sine';
                    gain.gain.value = 0;
                    
                    const startTime = now + i * 0.4;
                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(0.15, startTime + 0.2);
                    gain.gain.linearRampToValueAtTime(0, startTime + 0.8);
                    
                    osc.start(startTime);
                    osc.stop(now + duration);
                    oscillators.push(osc);
                    gains.push(gain);
                });
                
                return { oscillators, gains };
            },
            
            urgent: (ctx, duration = 3) => {
                const osc1 = ctx.createOscillator();
                const osc2 = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc1.connect(gain);
                osc2.connect(gain);
                gain.connect(ctx.destination);
                
                osc1.type = 'sawtooth';
                osc2.type = 'square';
                gain.gain.value = 0.25;
                
                const now = ctx.currentTime;
                // Alternating frequencies for urgency
                for (let i = 0; i < duration * 4; i++) {
                    const time = now + i * 0.25;
                    const freq = i % 2 === 0 ? 880 : 988;
                    osc1.frequency.setValueAtTime(freq, time);
                    osc2.frequency.setValueAtTime(freq * 1.5, time);
                }
                
                osc1.start(now);
                osc2.start(now);
                osc1.stop(now + duration);
                osc2.stop(now + duration);
                
                return { oscillators: [osc1, osc2], gains: [gain] };
            },
            
            chime: (ctx, duration = 3) => {
                const oscillators = [];
                const gains = [];
                const now = ctx.currentTime;
                
                // Bell-like harmonics
                const playChime = (startTime, baseFreq) => {
                    const harmonics = [1, 2, 2.4, 3, 4.2];
                    harmonics.forEach((h, i) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        
                        osc.frequency.value = baseFreq * h;
                        osc.type = 'sine';
                        
                        const amplitude = 0.15 / (i + 1);
                        gain.gain.setValueAtTime(amplitude, startTime);
                        gain.gain.exponentialRampToValueAtTime(0.001, startTime + 1.5);
                        
                        osc.start(startTime);
                        osc.stop(startTime + 1.5);
                        oscillators.push(osc);
                        gains.push(gain);
                    });
                };
                
                playChime(now, 523);
                playChime(now + 0.8, 659);
                playChime(now + 1.6, 784);
                
                return { oscillators, gains };
            },
            
            pulse: (ctx, duration = 3) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                
                osc.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                
                osc.type = 'sawtooth';
                osc.frequency.value = 110;
                filter.type = 'lowpass';
                filter.frequency.value = 800;
                filter.Q.value = 10;
                
                const now = ctx.currentTime;
                // Pulsing pattern
                for (let i = 0; i < duration * 4; i++) {
                    const time = now + i * 0.25;
                    gain.gain.setValueAtTime(0.3, time);
                    gain.gain.exponentialRampToValueAtTime(0.01, time + 0.15);
                    filter.frequency.setValueAtTime(1200, time);
                    filter.frequency.exponentialRampToValueAtTime(400, time + 0.2);
                }
                
                osc.start(now);
                osc.stop(now + duration);
                
                return { oscillators: [osc], gains: [gain] };
            }
        };

        function stopGeneratedSound() {
            currentOscillators.forEach(osc => {
                try { osc.stop(); } catch (e) {}
            });
            currentOscillators = [];
            currentGainNodes = [];
        }

        function playGeneratedSound(soundType, duration = 3) {
            stopGeneratedSound();
            const ctx = getAudioContext();
            if (ctx.state === 'suspended') {
                ctx.resume();
            }
            const { oscillators, gains } = soundGenerators[soundType](ctx, duration);
            currentOscillators = oscillators;
            currentGainNodes = gains;
        }

        // Elements
        const currentTimeEl = document.getElementById('currentTime');
        const currentDateEl = document.getElementById('currentDate');
        const alarmTimeInput = document.getElementById('alarmTime');
        const soundOptions = document.getElementById('soundOptions');
        const soundFileInput = document.getElementById('soundFile');
        const fileLabel = document.getElementById('fileLabel');
        const fileName = document.getElementById('fileName');
        const customPreviewBtn = document.getElementById('customPreviewBtn');
        const setAlarmBtn = document.getElementById('setAlarmBtn');
        const buttonRow = document.getElementById('buttonRow');
        const status = document.getElementById('status');
        const statusText = document.getElementById('statusText');
        const alarmCard = document.getElementById('alarmCard');
        const alarmAudio = document.getElementById('alarmAudio');

        // State
        let alarmSet = false;
        let alarmTriggered = false;
        let alarmTimeStr = null;
        let selectedSound = 'classic';
        let customAudioUrl = null;
        let alarmInterval = null;

        // Format time
        function formatTime(date) {
            return date.toLocaleTimeString('en-AU', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-AU', { 
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            currentTimeEl.textContent = formatTime(now);
            currentDateEl.textContent = formatDate(now);

            // Check alarm
            if (alarmSet && !alarmTriggered) {
                const currentTimeStr = formatTime(now);
                if (currentTimeStr === alarmTimeStr) {
                    triggerAlarm();
                }
            }
        }

        // Sound option selection
        document.querySelectorAll('.sound-option').forEach(option => {
            option.addEventListener('click', (e) => {
                if (e.target.classList.contains('preview-btn')) return;
                
                document.querySelectorAll('.sound-option').forEach(o => o.classList.remove('selected'));
                fileLabel.classList.remove('selected');
                option.classList.add('selected');
                option.querySelector('input').checked = true;
                selectedSound = option.dataset.sound;
            });
        });

        // Preview buttons for built-in sounds
        document.querySelectorAll('.preview-btn[data-preview]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const soundType = btn.dataset.preview;
                playGeneratedSound(soundType, 2);
            });
        });

        // Handle custom file selection
        soundFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileName.textContent = file.name;
                fileLabel.classList.add('selected');
                customPreviewBtn.style.display = 'block';
                
                // Deselect built-in options
                document.querySelectorAll('.sound-option').forEach(o => {
                    o.classList.remove('selected');
                    o.querySelector('input').checked = false;
                });
                
                selectedSound = 'custom';
                
                // Create object URL for the audio
                if (customAudioUrl) {
                    URL.revokeObjectURL(customAudioUrl);
                }
                customAudioUrl = URL.createObjectURL(file);
            }
        });

        // Custom file preview
        customPreviewBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (customAudioUrl) {
                alarmAudio.src = customAudioUrl;
                alarmAudio.currentTime = 0;
                alarmAudio.play().catch(err => {
                    alert('Could not play audio. Make sure the file is a valid audio format.');
                });
                setTimeout(() => {
                    alarmAudio.pause();
                    alarmAudio.currentTime = 0;
                }, 3000);
            }
        });

        // Set alarm
        function setAlarm() {
            alarmTimeStr = alarmTimeInput.value;
            alarmSet = true;
            alarmTriggered = false;

            // Update UI
            status.style.display = 'flex';
            status.className = 'status active';
            statusText.textContent = `Alarm set for ${alarmTimeStr}`;
            
            buttonRow.innerHTML = `
                <button class="btn btn-danger" id="cancelAlarmBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M15 9l-6 6"></path>
                        <path d="M9 9l6 6"></path>
                    </svg>
                    Cancel Alarm
                </button>
            `;

            document.getElementById('cancelAlarmBtn').addEventListener('click', cancelAlarm);
            
            // Disable inputs
            alarmTimeInput.disabled = true;
            soundFileInput.disabled = true;
            document.querySelectorAll('.sound-option').forEach(o => o.style.pointerEvents = 'none');
            fileLabel.style.pointerEvents = 'none';
        }

        setAlarmBtn.addEventListener('click', setAlarm);

        // Cancel alarm
        function cancelAlarm() {
            alarmSet = false;
            alarmTriggered = false;
            alarmTimeStr = null;
            
            // Stop sounds
            stopGeneratedSound();
            alarmAudio.pause();
            alarmAudio.currentTime = 0;
            if (alarmInterval) {
                clearInterval(alarmInterval);
                alarmInterval = null;
            }
            
            // Reset UI
            alarmCard.classList.remove('ringing');
            status.style.display = 'none';
            
            buttonRow.innerHTML = `
                <button class="btn btn-primary" id="setAlarmBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="13" r="8"></circle>
                        <path d="M12 9v4l2 2"></path>
                        <path d="M5 3L2 6"></path>
                        <path d="M22 6l-3-3"></path>
                    </svg>
                    Set Alarm
                </button>
            `;

            document.getElementById('setAlarmBtn').addEventListener('click', setAlarm);
            
            // Re-enable inputs
            alarmTimeInput.disabled = false;
            soundFileInput.disabled = false;
            document.querySelectorAll('.sound-option').forEach(o => o.style.pointerEvents = 'auto');
            fileLabel.style.pointerEvents = 'auto';
        }

        // Trigger alarm
        function triggerAlarm() {
            alarmTriggered = true;
            
            // Update UI
            alarmCard.classList.add('ringing');
            status.className = 'status ringing';
            statusText.textContent = 'WAKE UP!';
            
            buttonRow.innerHTML = `
                <button class="btn btn-danger" id="stopAlarmBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="6" y="6" width="12" height="12" rx="2"></rect>
                    </svg>
                    Stop Alarm
                </button>
            `;

            document.getElementById('stopAlarmBtn').addEventListener('click', cancelAlarm);
            
            // Play sound
            if (selectedSound === 'custom' && customAudioUrl) {
                alarmAudio.src = customAudioUrl;
                alarmAudio.currentTime = 0;
                alarmAudio.play().catch(err => {
                    console.error('Could not play audio:', err);
                    alert('Could not play alarm sound. Browser may have blocked autoplay.');
                });
            } else {
                // Play generated sound in a loop
                playGeneratedSound(selectedSound, 4);
                alarmInterval = setInterval(() => {
                    if (alarmTriggered) {
                        playGeneratedSound(selectedSound, 4);
                    }
                }, 4000);
            }

            // Try notification
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Alarm!', { body: 'Time to wake up!' });
            }
        }

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Initialize
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);

        // Prevent sleep on mobile
        let wakeLock = null;
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (err) {
                console.log('Wake lock not supported or failed');
            }
        }
        requestWakeLock();
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                requestWakeLock();
            }
        });
    </script>
</body>
</html>
